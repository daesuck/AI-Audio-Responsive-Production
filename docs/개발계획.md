# AI 오디오 반응형 무대조명 시스템 - 개발계획

**버전**: v1.0 MVP
**마지막 업데이트**: 2026년 2월 9일

---

## 1. 프로젝트 개요

AI 오디오 반응형 무대조명 시스템은 실시간 오디오 입력을 분석하여 무대 조명과 픽셀 LED를 자동으로 제어하는 통합 조명 연출 시스템입니다.

**핵심 특징**:
- 실시간 오디오 분석 기반 조명 제어
- 다양한 연출 모드 지원
- DMX 표준 프로토콜 준수
- 완전 자동화된 설치 마법사
- 장애 안전 메커니즘

---

## 2. MVP 범위 (v1.0)

### 2.1 포함 기능
- **오디오 입력**: 실시간 마이크 입력 수신
- **신호 처리**: FFT 기반 주파수 분석
- **조명 제어**: DMX 프로토콜 출력
- **픽셀 제어**: RGB LED 4채널 제어
- **자동 연출**: 3가지 기본 모드 자동 연출
- **설정 인터페이스**: Install Wizard를 통한 초기 설정
- **모니터링**: 기본 상태 모니터링 및 로깅

### 2.2 제외 기능 (v2.0 이상)
- 수동 조명 편집 인터페이스
- 연출 시나리오 저장/로드
- 고급 AI 학습 기반 제어
- 멀티 유니버스 DMX 지원
- 웹 기반 원격 제어
- 상세 분석 대시보드

---

## 3. 출력 구성

### 3.1 DMX Universe 1
| 항목 | 사양 |
|------|------|
| 유니버스 | Universe 1 |
| 채널 범위 | 1~512 |
| 반응 속도 | 최대 30fps |
| 제어 대象 | 무대 조명 기구 (조절 가능하게 설정) |
| 프로토콜 | DMX512 |

**DMX 채널 설정**:
- 채널 1~100: 예약 (향후 확장)
- 채널별 설정은 Install Wizard에서 사용자가 지정

### 3.2 픽셀 4채널 (RGB LED 스트립)
| 채널 | 기능 | 해상도 | 속도 |
|------|------|--------|------|
| 채널 1 | Main RGB Strip | 0~1024 픽셀 | 30fps |
| 채널 2 | Accent RGB Strip | 0~1024 픽셀 | 30fps |
| 채널 3 | Back RGB Strip | 0~1024 픽셀 | 30fps |
| 채널 4 | Effect RGB Strip | 0~1024 픽셀 | 30fps |

**픽셀 색상**:
- 각 픽셀: RGB (8bit R, 8bit G, 8bit B)
- 아드레싱: WS2812B 또는 유사 프로토콜 (타입별 설정 가능)

---

## 4. 동작 모드

### 4.1 SPEECH 모드 (음성 인식)
**용도**: 뮤지컬, 강연, 프레젠테이션

**특징**:
- 음성 강도(에너지) 기반 반응
- 저주파(저음) 동작: 강조 조명 활성화
- 준음성 구간: 부드러운 페이드 효과
- 음성 없음: 기본 대기 모드로 전환

**주요 매개변수**:
- 반응도: 조정 가능 (1~10)
- 감쇠 속도: 조정 가능 (0.1~1.0초)

### 4.2 MUSIC 모드 (음악 동기)
**용도**: 콘서트, 뮤직비디오, DJ 공연

**특징**:
- 전체 주파수 스펙트럼 분석
- 베이스(저음): DMX 강도 제어
- 중음역: 픽셀 채도 제어
- 고음역: 픽셀 명도 및 애니메이션 속도 제어
- 비트 감지: 강렬한 조명 펄스

**주요 매개변수**:
- 베이스 민감도: 조정 가능
- 피크 감지 임계값: 조정 가능
- 색상 매핑: 프리셋 또는 사용자 정의

### 4.3 IDLE 모드 (대기 모드)
**용도**: 이벤트 준비, 일반 배경 조명

**특징**:
- 오디오 입력 없음 또는 조용함
- 부드러운 페이드 애니메이션
- 프리셋 색상 사이클
- 최소 에너지 사용

**주요 매개변수**:
- 애니메이션 속도: 조정 가능
- 기본 색상: 사용자 정의 가능

---

## 5. Install Wizard 개요

### 5.1 목적
새 사용자를 위한 완전 자동화된 설치 및 초기 설정 프로세스

### 5.2 단계별 프로세스

**Step 1: 환영 및 언어 선택**
- 시스템 언어 선택 (한국어/영어)

**Step 2: 하드웨어 구성**
- DMX 인터페이스 선택 (USB/직렬/네트워크)
- 포트 감지 및 자동 선택
- 픽셀 인터페이스 유형 선택 (GPIO/USB/SPI)
- 픽셀 수 입력 (채널당)

**Step 3: 스트림 자동 테스트**
- DMX 연결 테스트 (모든 채널 0->255->0)
- 픽셀 연결 테스트 (순차 조명)
- 오디오 입력 테스트 (마이크 감도 확인)
- 결과 표시 및 재시도 옵션

**Step 4: 모드별 기본 설정**
- SPEECH 모드: 반응도, 감쇠 속도
- MUSIC 모드: 색상 프리셋, 스펙트럼 매핑
- IDLE 모드: 애니메이션 선택

**Step 5: DMX 채널 매핑 (옵션)**
- 사용할 DMX 채널 범위 지정
- 각 함수에 채널 할당
- 테스트 및 미세 조정

**Step 6: 완료 및 저장**
- 설정 저장 (config.json)
- 시스템 시작
- 빠른 시작 가이드 표시

### 5.3 특징
- 자동 감지로 수동 입력 최소화
- 각 단계마다 테스트 실행
- 롤백 가능한 설정
- 나중에 재실행 가능

---

## 6. Fail-safe 정책

### 6.1 오디오 입력 손실
**상황**: 마이크 연결 끊김, 좀비 신호

**대응**:
1. 연속 5프레임 이상 무음 감지 시
2. IDLE 모드로 자동 전환
3. 오디오 이벤트 로그 기록
4. 재연결 감시 (5초 재시도)

### 6.2 DMX 연결 손실
**상황**: USB 연결 끊김, 직렬 포트 오류

**대응**:
1. DMX 전송 실패 감지
2. 모든 DMX 채널을 0으로 설정 (조명 모두 off)
3. 연결 재시도 (지수 백오프: 1초 → 5초 → 30초)
4. 디버그 로그 작성

### 6.3 픽셀 인터페이스 손실
**상황**: GPIO/USB 연결 오류

**대응**:
1. 픽셀 전송 실패 감지
2. 픽셀 4채널 모두 OFF
3. DMX 조명은 계속 작동
4. 사용자에게 경고 알림

### 6.4 CPU/메모리 과부하
**상황**: 프레임 드롭, 응답 지연

**대응**:
1. 프레임 레이트 모니터링 (목표: 30fps)
2. 프레임 드롭 시 픽셀 업데이트 빈도 감소
3. FFT 분석 해상도 자동 조정
4. 경고 로그 및 성능 메트릭 기록

### 6.5 우아한 종료 (Graceful Shutdown)
**프로세스**:
1. 수신한 종료 신호 (SIGTERM/SIGINT)
2. 현재 프레임 처리 완료 대기
3. 모든 출력 정상화 (조명 OFF, 픽셀 OFF)
4. 상태 파일 저장
5. 리소스 정리 후 종료

---

## 7. 개발 마일스톤 (단계별 계획)

### 0단계: 프로젝트 기초 설정 ✅
**목표**: 개발 환경 및 기초 문서 작성
- ✅ 프로젝트 구조 생성
- ✅ 개발계획.md 작성
- ⏳ 기술 스택 정의
- ⏳ 개발 환경 설정 (GitHub, CI/CD)

**완료 시기**: 2025년 2월 주

**산출물**:
- 개발계획.md (이 문서)
- README.md (프로젝트 소개)
- 프로젝트 폴더 구조

---

### 1단계: 오디오 입력 & 신호 처리 엔진
**목표**: 실시간 오디오 수신 및 스펙트럼 분석

**작업 항목**:
- [ ] 오디오 장치 열거 및 선택 모듈
- [ ] 실시간 오디오 캡처 (pyaudio/sounddevice)
- [ ] FFT 기반 스펙트럼 분석
- [ ] 주파수 대역 분류 (저음, 중음, 고음)
- [ ] 신호 처리 파이프라인 레벨 테스트
- [ ] 단위 테스트 작성

**예상 기간**: 2주

**산출물**:
- `audio_engine.py` - 핵심 오디오 처리
- `spectrum_analyzer.py` - FFT 분석
- 테스트 수트

---

### 2단계: DMX 출력 드라이버
**목표**: DMX512 프로토콜 기반 조명 제어

**작업 항목**:
- [ ] DMX 하드웨어 인터페이스 라이브러리 선택 (pyDMX/pyserial)
- [ ] DMX 세션 생성 및 관리
- [ ] 채널 값 설정 및 전송 기능
- [ ] 포트 자동 감지 추가
- [ ] 에러 핸들링 및 재연결 로직
- [ ] 테스트 및 검증

**예상 기간**: 1.5주

**산출물**:
- `dmx_controller.py` - DMX 제어 모듈
- 포트 감지 유틸리티

---

### 3단계: 픽셀 LED 제어 드라이버
**목표**: WS2812B 및 유사 RGB LED 제어

**작업 항목**:
- [ ] 픽셀 인터페이스 라이브러리 선택 (rpi_ws281x/FastLED/직렬)
- [ ] 색상 데이터 구조 및 변환
- [ ] 픽셀 시퀀스 생성 함수
- [ ] 4채널 독립 제어
- [ ] 애니메이션 프리미티브 (fade, pulse, chase)
- [ ] 테스트 및 검증

**예상 기간**: 2주

**산출물**:
- `pixel_controller.py` - 픽셀 제어 모듈
- `animation_engine.py` - 애니메이션 엔진

---

### 4단계: 동작 모드 구현 (SPEECH/MUSIC/IDLE)
**목표**: 3가지 동작 모드의 연출 엔진 개발

**작업 항목**:
- [ ] 모드 인터페이스 정의
- [ ] SPEECH 모드: 음성 감지 및 강도 매핑
- [ ] MUSIC 모드: 주파수 분석 및 색상 매핑
- [ ] IDLE 모드: 기본 애니메이션
- [ ] 모드 전환 로직 (부드러운 페이드)
- [ ] 파라미터 튜닝 및 테스트

**예상 기간**: 2.5주

**산출물**:
- `speech_mode.py`
- `music_mode.py`
- `idle_mode.py`
- `mode_manager.py`

---

### 5단계: Install Wizard 개발
**목표**: 완전 자동화된 설치 및 초기 설정 시스템

**작업 항목**:
- [ ] CLI 기반 인터페이스 구축 (Questionary/Click)
- [ ] Step 1-6 UI 및 로직 구현
- [ ] 하드웨어 감지 및 테스트
- [ ] 설정 파일 생성 및 저장 (JSON)
- [ ] 설정 검증 및 오류 처리
- [ ] Undo/Skip 기능
- [ ] 로컬라이제이션 (한국어/영어)

**예상 기간**: 2주

**산출물**:
- `install_wizard.py` - 마법사 메인
- `config_manager.py` - 설정 관리
- `hardware_detector.py` - 자동 감지

---

### 6단계: Fail-safe & 통합 테스트
**목표**: 시스템 안정성 및 신뢰도 향상

**작업 항목**:
- [ ] 모든 Fail-safe 로직 구현
- [ ] 재연결 메커니즘 (오디오/DMX/픽셀)
- [ ] 성능 모니터링 (FPS, CPU, 메모리)
- [ ] 로깅 시스템 구축
- [ ] 통합 테스트 시나리오
- [ ] 스트레스 테스트
- [ ] 문서화 (사용자/개발자 가이드)

**예상 기간**: 2주

**산출물**:
- 시스템 통합 결과
- 테스트 보고서
- 사용자 매뉴얼
- 개발자 API 문서

---

### 7단계: 최적화 & 릴리스 준비
**목표**: v1.0 공식 릴리스

**작업 항목**:
- [ ] 성능 최적화
  - FFT 해상도 자동 조정
  - 프레임 드롭 최소화
  - 메모리 누수 점검
- [ ] 코드 정리 및 리팩토링
- [ ] 보안 감사
- [ ] 배포 패킹 (EXE/AppImage)
- [ ] 설치 패키지 생성
- [ ] QA 최종 테스트
- [ ] 릴리스 노트 작성

**예상 기간**: 2주

**산출물**:
- v1.0 최종 빌드
- 배포 패키지
- 설치 가이드
- 릴리스 노트

---

## 8. 기술 스택 (예정)

### 언어
- **Python 3.10+** (메인 개발)
- **C/C++** (성능 크리티컬 부분, 선택 사항)

### 핵심 라이브러리
- **오디오**: sounddevice, scipy
- **DMX**: pyDMX 또는 pyserial
- **픽셀**: rpi_ws281x (Raspberry Pi) 또는 FastLED (Arduino)
- **데이터 처리**: numpy, scipy (FFT)
- **UI**: Click, Questionary (CLI)
- **로깅**: logging, loguru
- **구성**: JSON (내장) 또는 YAML

### 개발 도구
- Git & GitHub (버전 관리)
- pytest (단위 테스트)
- black, flake8 (코드 스타일)
- sphinx (문서화)
- GitHub Actions (CI/CD)

---

## 9. 참고사항

### 용어 정의
- **Universe**: DMX 프로토콜의 독립적인 512채널 세트
- **픽셀**: 개별 RGB LED 마이크로 제어 장치
- **비트(Beat)**: 음악의 강한 리듬 구간
- **Fail-safe**: 장애 발생 시 안전한 상태로 자동 복구

### 향후 확장 (v2.0+)
1. 멀티 유니버스 DMX 지원
2. 수동 조명 편집 프로그램
3. 연출 시나리오 저장/로드
4. 웹 기반 원격 제어
5. 고급 AI 기반 자동 연출
6. VST/플러그인 интеграция
7. 다국어 지원 확대

---

## 10. 연락처 & 피드백
**프로젝트 관리자**: [설정 예정]
**문제 보고**: GitHub Issues
**기능 요청**: GitHub Discussions

---

**이 문서는 개발 과정에서 필요에 따라 업데이트됩니다.**
마지막 갱신: 2026년 2월 9일
